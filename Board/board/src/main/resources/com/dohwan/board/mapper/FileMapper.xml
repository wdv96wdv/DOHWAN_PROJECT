<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- namespace="ë§¤í¼ ì¸í„°íŽ˜ì´ìŠ¤ ê²½ë¡œ" --> 
<mapper namespace="com.dohwan.board.mapper.FileMapper">

    <!-- íŒŒì¼ ëª©ë¡ -->
    <select id="list" resultType="Files">
        SELECT *
        FROM files
        ORDER BY created_at DESC
    </select>

    <!-- íŒŒì¼ ëª©ë¡ - ë¶€ëª¨ í…Œì´ë¸” ê¸°ì¤€ -->
    <!-- * íŒŒì¼ì´ ì¢…ì†ë˜ëŠ” í…Œì´ë¸”ì„ ê¸°ì¤€ìœ¼ë¡œ íŒŒì¼ ëª©ë¡ì„ ì¡°íšŒ -->
    <!-- * ê²Œì‹œê¸€ ë²ˆí˜¸ 10 
           ðŸ“„ íŒŒì¼ ë²ˆí˜¸ 1
           ðŸ“„ íŒŒì¼ ë²ˆí˜¸ 2
           ðŸ“„ íŒŒì¼ ë²ˆí˜¸ 3
     -->
    <select id="listByParent" resultType="Files">
        SELECT *
        FROM files
        WHERE p_table = #{pTable}
          AND p_no = #{pNo}
        ORDER BY created_at DESC
    </select>

    <!-- íŒŒì¼ ì¡°íšŒ -->
    <select id="select" resultType="Files">
        SELECT *
        FROM files
        WHERE no = #{no}
    </select>

    <!-- íŒŒì¼ ì¡°íšŒ -->
    <select id="selectById" resultType="Files">
        SELECT *
        FROM files
        WHERE id = #{id}
    </select>

    <!-- íŒŒì¼ ë“±ë¡ -->
    <insert id="insert" parameterType="Files" useGeneratedKeys="true" keyProperty="no">
        INSERT INTO files( 
        id, 
        p_table,
        p_no,
        file_name,
        origin_name,
        file_path,
        file_size,
        type,
        seq 
        )
        VALUES ( 
        #{id},
        #{pTable}, 
        #{pNo}, 
        #{fileName}, 
        #{originName}, 
        #{filePath}, 
        #{fileSize}, 
        #{type},
        #{seq} 
        )
    </insert>

    <!-- íŒŒì¼ ìˆ˜ì • -->
    <update id="update">
        UPDATE files
        <set>
        <if test="type != null">
        type = #{type},
        </if>
        <if test="seq != null">
        seq = #{seq},
        </if>
        <if test="pTable != null">
            p_table = #{pTable},
            <if test="pNo != null">
            p_no = #{pNo},
            </if>
            <if test="fileName != null">
            file_name = #{fileName},
            </if>
            <if test="originName != null">
            </if>
            origin_name = #{originName},
            </if>
            <if test="filePath != null">
            file_path = #{filePath},
            </if>
            <if test="fileSize != null">
            file_size = #{fileSize},
            </if>
            update_at = now()
       </set>
        WHERE no = #{no}
    </update>

        <!-- íŒŒì¼ ìˆ˜ì • -->
    <update id="updateById">
        UPDATE files
        <set>
        <if test="type != null">
        type = #{type},
        </if>
        <if test="seq != null">
        seq = #{seq},
        </if>
        <if test="pTable != null">
            p_table = #{pTable},
            <if test="pNo != null">
            p_no = #{pNo},
            </if>
            <if test="fileName != null">
            file_name = #{fileName},
            </if>
            <if test="originName != null">
            </if>
            origin_name = #{originName},
            </if>
            <if test="filePath != null">
            file_path = #{filePath},
            </if>
            <if test="fileSize != null">
            file_size = #{fileSize},
            </if>
            update_at = now()
       </set>
        WHERE id = #{id}
    </update>

    <!-- íŒŒì¼ ì‚­ì œ -->
    <delete id="delete">
        DELETE FROM files
        WHERE no = #{no}
    </delete>

      <!-- íŒŒì¼ ì‚­ì œ -->
    <delete id="deleteById">
        DELETE FROM files
        WHERE id = #{id}
    </delete>


    <!-- íŒŒì¼ ëª©ë¡ ì‚­ì œ - ë¶€ëª¨ í…Œì´ë¸” ê¸°ì¤€ íŒŒì¼ ëª©ë¡ ì‚­ì œ -->
    <delete id="deleteByParent">
        DELETE FROM files
        WHERE p_table = #{pTable}
          AND p_no = #{pNo}
    </delete>

    <!-- âœ¨ #{}  vs ${} -->
    <!-- #{ë³€ìˆ˜ëª…} âž¡ï¸ 'ê°’' -->
    <!-- ${ë³€ìˆ˜ëª…} âž¡ï¸  ê°’  -->


    <!-- ì„ íƒ ì‚­ì œ -no (ë¬¸ìžì—´ - IN) -->
    <delete id="delteFiles">
    DELETE FROM files
    WHERE no IN ( ${no} )
    </delete>
   
    <!-- ì„ íƒ ì‚­ì œ -id (ë¬¸ìžì—´ - IN) -->
    <!--id IN ('ID1', 'ID2', 'ID3')-->
    <delete id="delteFilesById">
    DELETE FROM files
    WHERE no IN ( ${id} )
    </delete>

    <!-- ì„ íƒ ì‚­ì œ -no (List ì»¬ë ‰ì…˜ )--> 
   <delete id="delteFilesList">
    DELETE FROM files
    WHERE id IN 
        <foreach collection="noList" item="no" open="(" separator="," close=")">
            #{no}
        </foreach>
    </delete>
   
    <!-- ì„ íƒ ì‚­ì œ -id (List ì»¬ë ‰ì…˜ )-->
    <delete id="delteFilesListById">
    DELETE FROM files
    WHERE id IN 
        <foreach collection="noList" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>
   
    <!-- íƒ€ìž…ë³„ íŒŒì¼ ì¡°íšŒ-->
    <select id="selecfByType" resultType="Files">
        SLECT *
        FROM files
        WHERE p_table = #{pTable}
        AND p_no = #{pNo}
        AND type = #{type}
        LIMIT 0, 1
    </select>

    <!-- íƒ€ìž…ë³„ íŒŒì¼ ëª©ë¡-->
    <select id="listByType" resultType="Files">
        SLECT *
        FROM files
        WHERE p_table = #{pTable}
        AND p_no = #{pNo}
        AND type = #{type}
    </select>

</mapper>